<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EcoGrid â€“ Turning Waste into Smart Power</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <style>
    /* Simple modal styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      width: 300px;
      text-align: center;
    }
    .close {
      float: right;
      cursor: pointer;
      font-size: 18px;
    }

    /* Subscription Section */
    .subscriptions {
      text-align: center;
      padding: 60px 5%;
      background: linear-gradient(135deg, #e9f9ee, #dff7ff);
      border-radius: 20px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
      position: relative;
      z-index: 10;
    }

    .subscriptions h2 {
      color: #0b3d2e;
      font-size: 2rem;
      margin-bottom: 10px;
    }

    .subscriptions p {
      color: #444;
      margin-bottom: 30px;
    }

    .subscription-cards {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 20px;
    }

    .sub-card {
      background: white;
      border-radius: 15px;
      padding: 25px;
      width: 250px;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    .sub-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    }

    .sub-card h3 {
      color: #0b3d2e;
      margin-bottom: 10px;
    }

    .sub-card p {
      margin: 6px 0;
      font-size: 0.95rem;
      color: #555;
    }

    .sub-card button {
      background: #0b3d2e;
      color: white;
      border: none;
      padding: 10px 18px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      transition: background 0.3s ease, transform 0.2s ease;
    }

    .sub-card button:hover {
      background: #0f684e;
      transform: scale(1.05);
    }

    .sub-card button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    #qr-container {
      background: #fff;
      border-radius: 10px;
      padding: 15px;
      width: fit-content;
      margin: 30px auto;
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
      animation: fadeIn 0.6s ease forwards;
    }

    #qr-img {
      width: 200px;
      margin-top: 10px;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <div class="page-wrapper">
    <!-- Navbar -->
    <header>
      <nav class="navbar">
        <div class="logo">âš¡ EcoGrid</div>
<ul class="nav-links" id="navLinks">
  <li><a href="/" class="active">Home</a></li>
  <li><a href="/about">About Us</a></li>
  <li><a href="/contact">Contact</a></li>

  {% if user %}
    {% if user.role == "admin" %}
      <li><a href="/heatmap">Heatmap</a></li>
    {% endif %}
    <li>
      <img src="{{ url_for('static', filename='images/user-icon.jpg') }}" 
          alt="User Icon" class="user-icon" id="userIcon" 
          style="cursor:pointer;width:40px;border-radius:50%;" />
    </li>
    <li><a href="/logout" class="button">Logout</a></li>
  {% else %}
    <li><a href="/login" class="button">Login</a></li>
    <li><a href="/signup" class="button">Signup</a></li>
  {% endif %}
</ul>

        <div class="menu-icon" id="menu-icon">â˜°</div>
      </nav>
    </header>

    <!-- Hero Section -->
    <section class="hero fade-in" style="
        background: url('{{ url_for('static', filename='images/bg.jpg') }}') no-repeat center center;
        background-size: cover;
        position: relative;
        padding: 120px 20px;
        color: white;
        text-align: center;
    ">
      <div style="
          position: absolute;
          top: 0; left: 0;
          width: 100%; height: 100%;
          background-color: rgba(0,0,0,0.5);
          z-index: 1;
      "></div>

      <div style="position: relative; z-index: 2; max-width: 800px; margin: 0 auto;">
        <h1>Turning Wastewater into Smart Sustainable Power</h1>
        <p>
          EcoGrid generates green electricity using sewage water through
          Microbial Fuel Cells (MFCs), storing it in smart grid systems and
          collaborating with TNEB for efficient energy distribution.
        </p>
        <a href="/about" class="btn" style="margin-top: 20px; display: inline-block;">Learn More</a>
      </div>
    </section>

    <!-- Ideas Section -->
    <section class="ideas slide-up">
      <h2>ðŸ’¡ Our Idea</h2>
      <p>
        We convert wastewater into electricity using Microbial Fuel Cells
        (MFCs). The generated power is stored in EcoGrid batteries and
        distributed like LPG supply â€” creating an eco-friendly, decentralized
        energy solution.
      </p>
    </section>

    <!-- What We Do -->
    <section class="services fade-in">
      <h2>âš™ What We Do</h2>
      <div class="service-cards">
        <div class="card">
          <h3>Microbial Fuel Cells</h3>
          <p>Harness natural bacterial reactions to generate clean electricity.</p>
        </div>
        <div class="card">
          <h3>AI Forecasting</h3>
          <p>AI predicts demand using LSTM models to optimize energy flow.</p>
        </div>
        <div class="card">
          <h3>Grid Collaboration</h3>
          <p>Partnering with TNEB to supply renewable energy efficiently.</p>
        </div>
      </div>
    </section>

    <!-- Subscription Section -->
    <section class="subscriptions fade-in">
      <h2>ðŸ’³ Subscribe to EcoGrid</h2>
      <p>Choose a plan and get updates via SMS.</p>

      <div class="subscription-cards">
        {% for plan in plans %}
        <div class="sub-card">
          <h3>{{ plan.name }}</h3>
          <p>Price: â‚¹{{ plan.price }}</p>
          <p>Power Output: {{ plan.power_output }}</p>
          <button 
            class="select-btn"
            data-id="{{ plan.id }}" 
            data-name="{{ plan.name }}" 
            data-price="{{ plan.price }}" 
            data-power="{{ plan.power_output }}">
            Select Plan
          </button>
        </div>
        {% endfor %}
      </div>

      <div id="qr-container" style="text-align:center; margin-top:20px; display:none;">
        <h4>ðŸ“² Scan to Pay</h4>
        <img id="qr-img" src="" alt="QR Code" />
      </div>

      <!-- Suggestion Button -->
<div style="text-align:center; margin-top: 30px;">
  <button id="suggestionBtn" 
          style="background:#0b3d2e; color:white; padding:12px 25px; border-radius:10px; font-size:1rem; cursor:pointer;">
    Need Suggestion
  </button>
</div>

    </section>

    <!-- Footer -->
    <footer>
      <p>Â© 2025 EcoGrid | Designed by Thunder Coders | Sustainable Energy for All</p>
    </footer>
  </div>

  <!-- User Details Modal -->
  <div id="userModal" class="modal">
    <div class="modal-content">
      <span class="close" id="closeModal">&times;</span>
      <h3>User Details</h3>
      <p><b>Name:</b> <span id="userName"></span></p>
      <p><b>Email:</b> <span id="userEmail"></span></p>
      <p><b>Mobile:</b> <span id="userMobile"></span></p>
      <p><b>Selected Plan:</b> <span id="userPlan"></span></p>
    </div>
  </div>

  <script>
    const isUserLoggedIn = {{ 'true' if user else 'false' }};
    let selectedPlan = null;
    let userDetails = null;

    // Navbar toggle
    const menu = document.getElementById("menu-icon");
    const nav = document.getElementById("navLinks");
    menu.onclick = () => nav.classList.toggle("open");

    // Fetch user details if logged in
    if (isUserLoggedIn) {
      fetch("/get_user_details")
        .then(res => res.json())
        .then(data => userDetails = data);
    }

    // Subscription buttons with event delegation
    document.addEventListener("click", async function(e) {
      if (e.target.classList.contains("select-btn")) {
        const button = e.target;
        const id = button.dataset.id;
        const name = button.dataset.name;
        const price = button.dataset.price;
        const power = button.dataset.power;

        if (!isUserLoggedIn) {
          alert("Please log in to subscribe!");
          window.location.href = "/login";
          return;
        }

        button.disabled = true;
        button.textContent = "Generating QR...";

        try {
          const paymentUrl = `https://paymentgateway.com/pay?amount=${price}`;
          const res = await fetch("/generate_qr", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ payment_url: paymentUrl })
          });
          const blob = await res.blob();
          const url = URL.createObjectURL(blob);
          document.getElementById("qr-img").src = url;
          document.getElementById("qr-container").style.display = "block";

          // Auto SMS
          if (userDetails && userDetails.mobile) {
            fetch("/send_sms", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                phone: userDetails.mobile,
                message: `You subscribed to ${name} for â‚¹${price}. Thank you for supporting sustainable energy!`
              })
            }).then(res => res.json()).then(data => {
              if (data.success) alert(`SMS sent successfully to ${userDetails.mobile}!`);
            });
          }

        } catch(err) {
          alert("Error generating QR: " + err.message);
        } finally {
          setTimeout(() => {
            button.disabled = false;
            button.textContent = "Select Plan";
          }, 5000);
        }
      }
    });

    // Modal handling
    const userIcon = document.getElementById("userIcon");
    const userModal = document.getElementById("userModal");
    const closeModal = document.getElementById("closeModal");
    if (userIcon) {
      userIcon.addEventListener("click", () => {
        fetch("/get_user_details").then(res => res.json()).then(data => {
          document.getElementById("userName").textContent = data.name || "-";
          document.getElementById("userEmail").textContent = data.email || "-";
          document.getElementById("userMobile").textContent = data.mobile || "-";
          document.getElementById("userPlan").textContent = data.plan || "No plan selected";
          userModal.style.display = "flex";
        });
      });
    }
    closeModal.onclick = () => userModal.style.display = "none";
    window.onclick = (e) => { if (e.target === userModal) userModal.style.display = "none"; };
    // Redirect to user.html on click
const suggestionBtn = document.getElementById("suggestionBtn");
if (suggestionBtn) {
  suggestionBtn.addEventListener("click", () => {
    window.location.href = "/user";  // assuming Flask route is '/user'
  });
}

  </script>
</body>
</html>
